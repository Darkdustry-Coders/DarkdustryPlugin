name: Компиляция плагина

on: [push]

jobs:

  buildJar:

    runs-on: ubuntu-latest

    steps:

    - uses: actions/checkout@v1

    - name: Подключение Java 16

      uses: actions/setup-java@v1

      with:

        java-version: 16

    - name: Настройка доступа к gradlew

      run: chmod +x ./gradlew

    - name: Сборка плагина в jar

      run: ./gradlew jar

    - name: Выгрузка jar

      uses: actions/upload-artifact@v2

      with:

        name: ${{ github.event.repository.name }}

        path: build/libs/

    - name: Коммит jar

      if: "contains(github.event.head_commit.message, '[c]') && !contains(github.event.head_commit.message, '[Plugin.jar]'"

      run: |

        git config --global user.email "cli@github.com"

        git config --global user.name "Github Actions"
        
        git config advice.addIgnoredFile true

        git add build/libs/*

        git commit -m "[Plugin.jar]"

        git push https://Darkdustry-Coders:${{ secrets.API_TOKEN_GITHUB }}@github.com/Darkdustry-Coders/DarkdustryPlugin
